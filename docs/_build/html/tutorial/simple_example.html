

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Discovering transmorph basics &mdash; transmorph  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> transmorph
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing transmorph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started with transmorph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">Transmorph API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">transmorph</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Discovering transmorph basics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorial/simple_example.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Discovering-transmorph-basics">
<h1>Discovering transmorph basics<a class="headerlink" href="#Discovering-transmorph-basics" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will demonstrate how to perform basic data integration using transmorph. We will use two spiraling datasets in order to test different transmorph options. All datasets used in this tutorial are available on transmorph’s <a class="reference external" href="https://github.com/Risitop/transmorph/tree/main/docs/tutorial/data">GitHub</a>.</p>
<section id="Synthetic-datasets">
<h2>Synthetic datasets<a class="headerlink" href="#Synthetic-datasets" title="Permalink to this headline">¶</a></h2>
<p>Let us start by loading our two datasets.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import numpy as np
from transmorph.datasets import load_spirals
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>X, Y = load_spirals()
X.shape, Y.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((433, 3), (663, 3))
</pre></div></div>
</div>
<p>We can then compute and plot them in a 2-PC space in order to get a closer look.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from sklearn.decomposition import PCA
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>pca = PCA(n_components=2)
pca = pca.fit(Y)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import matplotlib.pyplot as plt
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Plotting parameters

dotsize = 40
qcolor = &#39;royalblue&#39; # query
qmarker = &#39;s&#39;
rcolor = &#39;crimson&#39; # reference
rmarker = &#39;o&#39;
icolor = &#39;yellow&#39; # integrated
imarker = &#39;D&#39;
x_label = &#39;PC1&#39;
y_label = &#39;PC2&#39;
titlesize = 15
labelsize = 15
legendsize = 10
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Plotting function

def plot_datasets(*datasets,
                   title=None,
                   x_label=None,
                   y_label=None,
                   enable_cbar=False,
                   cbar_title=None,
                   **kwargs):
    for dataset in datasets:
        X = dataset[&#39;X&#39;]
        color = dataset[&#39;c&#39;]
        kwargs_to_pass = {k: dataset[k] for k in dataset if k not in (&#39;X&#39;, &#39;c&#39;)}
        plt.scatter(*X.T, c=color, **kwargs_to_pass, **kwargs)
    if x_label is not None:
        plt.xlabel(x_label, size=labelsize)
    if y_label is not None:
        plt.ylabel(y_label, size=labelsize)
    if any(&quot;label&quot; in dataset for dataset in datasets):
        plt.legend(fontsize=legendsize)
    plt.xticks([])
    plt.yticks([])

    if enable_cbar:
        cbar = plt.colorbar()
        if cbar_title is not None:
            cbar.ax.set_ylabel(cbar_title, fontsize=labelsize)

    if title is not None:
        plt.title(title, fontsize=titlesize)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>plt.figure(figsize=(6,6))
plot_datasets({
                   &quot;X&quot;: pca.transform(X),
                   &quot;label&quot;: &quot;Query spiral&quot;,
                   &quot;c&quot;: qcolor,
                   &quot;marker&quot;: qmarker
               },
               {
                   &quot;X&quot;: pca.transform(Y),
                   &quot;label&quot;: &quot;Reference spiral&quot;,
                   &quot;c&quot;: rcolor,
                   &quot;marker&quot;: rmarker
               },
               title=&quot;Synthetic spiral datasets in PC space, colored by dataset&quot;,
               x_label=x_label,
               y_label=y_label,
               ec=&#39;k&#39;,
               s=dotsize)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_simple_example_9_0.png" src="../_images/tutorial_simple_example_9_0.png" />
</div>
</div>
<p>We see two datasets in a spiraling fashion. We also observe the query dataset to present “holes” in the manifold, that integration method will have to account for.</p>
</section>
<section id="Dataset-integration">
<h2>Dataset integration<a class="headerlink" href="#Dataset-integration" title="Permalink to this headline">¶</a></h2>
<p>Let us load a transmorph object to perform dataset integration. We will try out and compare different parameters.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import transmorph as tr
import time
</pre></div>
</div>
</div>
<section id="1.-Basic-parameters">
<h3>1. Basic parameters<a class="headerlink" href="#1.-Basic-parameters" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>t_start = time.time()
transmorph_base = tr.Transmorph() # Create a default transmorph
X_integrated_base = transmorph_base.fit_transform(X, Y)
print(&quot;Elapsed:&quot;, time.time() - t_start, &quot;seconds&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Elapsed: 1.7032716274261475 seconds
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>plt.figure(figsize=(6,6))
plot_datasets({
                   &quot;X&quot;: pca.transform(Y),
                   &quot;label&quot;: &quot;Reference spiral&quot;,
                   &quot;c&quot;: rcolor,
                   &quot;marker&quot;: rmarker
               },
                {
                   &quot;X&quot;: pca.transform(X_integrated_base),
                   &quot;label&quot;: &quot;Integrated spiral&quot;,
                   &quot;c&quot;: icolor,
                   &quot;marker&quot;: imarker
               },
               title=&quot;Weighted integration of spiral datasets, colored by dataset&quot;,
               x_label=x_label,
               y_label=y_label,
               ec=&#39;k&#39;,
               s=dotsize)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_simple_example_15_0.png" src="../_images/tutorial_simple_example_15_0.png" />
</div>
</div>
<p>As we can see, integration is quite decent in terms of shape. What we can do to further assess integration quality is to compare the initial position of each point along the spiral manifold to its final position. Let us load point labels.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from transmorph.datasets import load_spirals_labels
lbl_X, lbl_Y = load_spirals_labels()
lbl_X.shape, lbl_Y.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((433,), (663,))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>plt.figure(figsize=(7.5,6))
plot_datasets({
                   &quot;X&quot;: pca.transform(X),
                   &quot;label&quot;: &quot;Query spiral&quot;,
                   &quot;c&quot;: lbl_X,
                   &quot;marker&quot;: qmarker
               },
               {
                   &quot;X&quot;: pca.transform(Y),
                   &quot;label&quot;: &quot;Reference spiral&quot;,
                   &quot;c&quot;: lbl_Y,
                   &quot;marker&quot;: rmarker
               },
               title=&quot;Synthetic spiral datasets in PC space, colored by position&quot;,
               x_label=x_label,
               y_label=y_label,
                enable_cbar=True,
                cbar_title=&quot;Point position&quot;,
               ec=&#39;k&#39;,
               s=dotsize)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_simple_example_18_0.png" src="../_images/tutorial_simple_example_18_0.png" />
</div>
</div>
<p>As expected, we observe in each dataset a smooth position gradient. Let us compare with after integration.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>plt.figure(figsize=(6,6))
plot_datasets({
                   &quot;X&quot;: pca.transform(Y),
                   &quot;label&quot;: &quot;Reference spiral&quot;,
                   &quot;c&quot;: &#39;silver&#39;,
                   &quot;marker&quot;: rmarker
               },
                {
                   &quot;X&quot;: pca.transform(X_integrated_base),
                   &quot;label&quot;: &quot;Integrated spiral&quot;,
                   &quot;c&quot;: lbl_X,
                   &quot;marker&quot;: imarker
               },
               title=&quot;Integration of spiral datasets, colored by position&quot;,
               x_label=x_label,
               y_label=y_label,
               ec=&#39;k&#39;,
               s=dotsize)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_simple_example_20_0.png" src="../_images/tutorial_simple_example_20_0.png" />
</div>
</div>
<p>The result is quite underwhelming. Even if the integration is decent shape-wise, as we can see plenty of external points mapped into the internal region. Avoiding such case (called “overcorrection”) is critical in real-life applications, as this leads to a misleading integration. Let us try to do better.</p>
</section>
<section id="2.-Weights-correction">
<h3>2. Weights correction<a class="headerlink" href="#2.-Weights-correction" title="Permalink to this headline">¶</a></h3>
<p>We can suspect dataset unbalance to be responsible for integration issues: as we have observed, the query dataset is full of “holes”, with higher density regions, while the reference one is quite continuous. Fortunately, transmorph features a parameter-free weight adjustement pre-processing in order to deal with such cases of dataset unbalance (see [1]). To enable it, we have to set the parameter <em>weighting_strategy</em> to <em>“woti”</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>t_start = time.time()
transmorph_weighted = tr.Transmorph(weighting_strategy=&#39;woti&#39;)
X_integrated_woti = transmorph_weighted.fit_transform(X, Y)
print(&quot;Elapsed:&quot;, time.time() - t_start, &quot;seconds&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Elapsed: 2.690639019012451 seconds
</pre></div></div>
</div>
<p>Let us start by observing the shape of the integrated dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>plt.figure(figsize=(6,6))
plot_datasets({
                   &quot;X&quot;: pca.transform(Y),
                   &quot;label&quot;: &quot;Reference spiral&quot;,
                   &quot;c&quot;: rcolor,
                   &quot;marker&quot;: rmarker
               },
                {
                   &quot;X&quot;: pca.transform(X_integrated_woti),
                   &quot;label&quot;: &quot;Integrated spiral&quot;,
                   &quot;c&quot;: icolor,
                   &quot;marker&quot;: imarker
               },
               title=&quot;Weighted integration of spiral datasets, colored by dataset&quot;,
               x_label=x_label,
               y_label=y_label,
               ec=&#39;k&#39;,
               s=dotsize)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_simple_example_25_0.png" src="../_images/tutorial_simple_example_25_0.png" />
</div>
</div>
<p>This already seems to be better. Let us observe how the position gradients look like.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>plt.figure(figsize=(6,6))
plot_datasets({
                   &quot;X&quot;: pca.transform(Y),
                   &quot;label&quot;: &quot;Reference spiral&quot;,
                   &quot;c&quot;: &#39;silver&#39;,
                   &quot;marker&quot;: rmarker
               },
                {
                   &quot;X&quot;: pca.transform(X_integrated_woti),
                   &quot;label&quot;: &quot;Integrated spiral&quot;,
                   &quot;c&quot;: lbl_X,
                   &quot;marker&quot;: imarker
               },
               title=&quot;Weighted integration of spiral datasets, colored by position&quot;,
               x_label=x_label,
               y_label=y_label,
               ec=&#39;k&#39;,
               s=dotsize)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_simple_example_27_0.png" src="../_images/tutorial_simple_example_27_0.png" />
</div>
</div>
<p>There are still a few miscorrected points, but this is already much more convincing. In this tutorial, we showed how monitoring the weighting strategy can improve integration quality.</p>
</section>
<section id="3.-Output-jittering">
<h3>3. Output jittering<a class="headerlink" href="#3.-Output-jittering" title="Permalink to this headline">¶</a></h3>
<p>The last small point I want to cover is output jittering. We found out that to increase stability of downstream methods such as UMAP, it was beneficial to add a small variation to the output. This is controlled by two parameters in <em>fit_transform()</em>: - <em>jitter</em>, boolean, default = True - <em>jitter_std</em>, float, default = 0.01</p>
<p>Let us try integration with different values for <em>jitter_std</em> to get an idea of how it influences the output.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>X_integrated_jitter = {
    sigma: transmorph_weighted.fit_transform(X, Y, jitter_std=sigma)
    for sigma in [.01, .02, .03, .04, .05]
}
X_integrated_jitter[0] = transmorph_weighted.fit_transform(X, Y, jitter=False)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>plt.figure(figsize=(18,12))
for i, sigma in enumerate(X_integrated_jitter):
    plt.subplot(2, 3, i+1)
    plot_datasets({
                       &quot;X&quot;: pca.transform(Y),
                       &quot;label&quot;: &quot;Reference spiral&quot;,
                       &quot;c&quot;: &#39;silver&#39;,
                       &quot;marker&quot;: rmarker
                   },
                    {
                       &quot;X&quot;: pca.transform(X_integrated_jitter[sigma]),
                       &quot;label&quot;: &quot;Integrated spiral&quot;,
                       &quot;c&quot;: lbl_X,
                       &quot;marker&quot;: imarker
                   },
                   title=&quot;jitter_std = %f&quot; % sigma,
                   x_label=x_label,
                   y_label=y_label,
                   ec=&#39;k&#39;,
                   s=dotsize)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_simple_example_30_0.png" src="../_images/tutorial_simple_example_30_0.png" />
</div>
</div>
</section>
</section>
<section id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this headline">¶</a></h2>
<p>[1] A. Fouché, A. Zinovyev, <em>Unsupervised weights selection for optimal transport based dataset integration</em>, bioRxiv 2021</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Aziz Fouché.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>